<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
  <title>Transactions Pie Chart</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
</head>
<body>
<canvas id="pie-chart"></canvas>

<script>
  var data = {
    labels: [],
    datasets: [{
      data: [],
      backgroundColor: []
    }]
  };

  var dataMap = /*[[${dataMap}]]*/ {};

  Object.keys(dataMap).forEach(function(key) {
    data.labels.push(key);
    data.datasets[0].data.push(dataMap[key]);
    data.datasets[0].backgroundColor.push(getRandomColor());
  });

  function getRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';

    for (var i = 0; i < 6; i++) {
      color += letters[Math.floor(Math.random() * 16)];
    }

    return color;
  }

  var totalAmount = /*[[${totalAmount}]]*/ 0;
  var options = {
    responsive: true,
    title: {
      display: true,
      text: 'Transactions by Category (Total Amount: ' + totalAmount.toFixed(2) + ')'
    }
  };

  console.log(dataMap);
  console.log(totalAmount);

  var ctx = document.getElementById('pie-chart').getContext('2d');
  new Chart(ctx, {
    type: 'pie',
    data: data,
    options: options
  });
</script>
</body>
</html>